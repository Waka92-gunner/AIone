<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tareas</title>
    <!-- Agregar el SDK de Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
      import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

      // Tu configuración de Firebase (deberías haberla copiado desde la consola de Firebase)
      const firebaseConfig = { 
        apiKey: "tu-api-key",
        authDomain: "tu-proyecto.firebaseapp.com",
        projectId: "tu-proyecto",
        storageBucket: "tu-proyecto.appspot.com",
        messagingSenderId: "tu-id-mensaje",
        appId: "tu-app-id"
      };

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);


      // Función para registrar un nuevo usuario
      const registerUser = async (email, password) => {
        try {
          await createUserWithEmailAndPassword(auth, email, password);
          alert("Usuario registrado exitosamente");
        } catch (error) {
          alert(error.message);
        }
      };

      // Función para iniciar sesión
      const loginUser = async (email, password) => {
        try {
          await signInWithEmailAndPassword(auth, email, password);
          alert("Inicio de sesión exitoso");
        } catch (error) {
          alert(error.message);
        }
      };

      // Mostrar estado de autenticación
      onAuthStateChanged(auth, (user) => {
        if (user) {
          document.getElementById("welcome-message").style.display = "block";
          document.getElementById("login-form").style.display = "none";
          document.getElementById("register-form").style.display = "none";
        } else {
          document.getElementById("welcome-message").style.display = "none";
          document.getElementById("login-form").style.display = "block";
          document.getElementById("register-form").style.display = "block";
        }
      });
    </script>
</head>
<body>
    <h1>Bienvenido a tu Lista de Tareas</h1>

    <!-- Formulario de Registro -->
    <div id="register-form">
        <h2>Registro</h2>
        <form id="register-form-element">
            <label for="register-email">Correo electrónico:</label>
            <input type="email" id="register-email" required />
            <label for="register-password">Contraseña:</label>
            <input type="password" id="register-password" required />
            <button type="submit">Registrar</button>
        </form>
    </div>

    <!-- Formulario de Login -->
    <div id="login-form">
        <h2>Iniciar Sesión</h2>
        <form id="login-form-element">
            <label for="login-email">Correo electrónico:</label>
            <input type="email" id="login-email" required />
            <label for="login-password">Contraseña:</label>
            <input type="password" id="login-password" required />
            <button type="submit">Iniciar sesión</button>
        </form>
    </div>

    <!-- Mensaje de Bienvenida -->
    <div id="welcome-message" style="display:none;">
        <h3>¡Bienvenido!</h3>
        <button id="logout-btn">Cerrar sesión</button>
    </div>

    <!-- Tareas -->
    <h2>Lista de Tareas</h2>
    <button id="add-task-btn">Agregar tarea</button>

    <!-- Contenedor de las tareas -->
    <div id="task-list"></div>

    <script type="module">
      // Tareas
      const taskList = document.getElementById("task-list");

      const addTask = async (task) => {
  try {
    // Agregar la tarea a Firestore
    await addDoc(collection(db, "tasks"), {
      task: task,
      timestamp: new Date()
    });
    alert("Tarea añadida con éxito");
    loadTasks(); // Cargar nuevamente las tareas desde Firestore
  } catch (e) {
    alert("Error al añadir tarea: ", e);
  }
};

const loadTasks = async () => {
  try {
    const querySnapshot = await getDocs(collection(db, "tasks"));
    taskList.innerHTML = ''; // Limpiar la lista antes de cargar las nuevas tareas
    querySnapshot.forEach((doc) => {
      const task = doc.data().task;
      const taskItem = document.createElement("div");
      taskItem.classList.add("task-item");
      taskItem.innerHTML = `
        <p>${task}</p>
        <button onclick="deleteTask('${doc.id}')">Eliminar</button>
      `;
      taskList.appendChild(taskItem);
    });
  } catch (e) {
    alert("Error al cargar tareas: ", e);
  }
};

const deleteTask = async (taskId) => {
  try {
    await deleteDoc(doc(db, "tasks", taskId)); // Eliminar la tarea de Firestore
    loadTasks(); // Recargar las tareas después de eliminar
  } catch (e) {
    alert("Error al eliminar tarea: ", e);
  }
};

      document.getElementById("add-task-btn").addEventListener("click", () => {
        const task = prompt("Escribe la tarea");
        if (task) {
          addTask(task);
        }
      });

      //Carga las tareas al inicar la app

      window.onload = loadTasks;

      // Eventos de formulario
      document.getElementById("register-form-element").addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("register-email").value;
        const password = document.getElementById("register-password").value;
        registerUser(email, password);
      });

      document.getElementById("login-form-element").addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;
        loginUser(email, password);
      });

      document.getElementById("logout-btn").addEventListener("click", () => {
        auth.signOut();
      });
    </script>
</body>
</html>
